# The Design Philosophy of the DARPA Internet Protocols

DARPA网络协议的设计哲学

## 摘要

Internet 协议套件 TCP/IP 于 15 年前（1973）首次提出。 它由国防高级研究计划局 (DARPA) 开发，并已广泛用于军事和商业系统。 虽然有描述协议如何工作的论文和规范，但有时很难从中推断出协议为何是现在的样子。 例如，Internet 协议基于无连接或数据报服务模式。 这样做的动机被大大误解了。 本文试图捕捉形成 Internet 协议的一些早期原因。

## 1 引言

在过去的 15 年中，美国国防部高级研究计划局一直在开发一套用于分组交换网络的协议。 这些协议，包括 Internet 协议 (IP) 和传输控制协议 (TCP)，现在是美国国防部的互联网络标准，并在商业网络环境中广泛使用。 在这项工作中开发的想法也影响了其他协议套件，最重要的是 ISO 协议的无连接配置。

虽然有关 DOD 协议的具体信息相当普遍，但有时很难确定导致设计的动机和原因。

事实上，设计理念已经从最初的提案发展到目前的标准。 例如，数据报或无连接服务的概念在第一篇论文中并未得到特别强调，但已成为协议的定义特征。 另一个例子是将架构分层到 IP 和 TCP 层。 这似乎是设计的基础，但也不是最初提案的一部分。 互联网设计的这些变化是通过在标准制定之前发生的重复实施和测试模式而产生的。

互联网架构仍在不断发展。 有时新的扩展会挑战设计原则之一，但无论如何，对设计历史的理解为当前的设计扩展提供了必要的背景。 ISO 协议的无连接配置也受到 Internet 套件历史的影响，因此了解 Internet 设计理念可能对那些使用 ISO 的人有所帮助。

本文对互联网体系结构的最初目标进行了分类，并讨论了这些目标与协议的重要特征之间的关系。

## 2 基本目标

DARPA 互联网架构的最高目标是开发一种有效的技术，以复用现有的互连网络。 需要有一些适当的详细说明，来明确该目标的含义。

互联网的组成部分是网络，它们相互连接以提供更大的服务。 最初的目标是将原始 ARPANET 与 ARPA 分组无线电网络连接在一起，以便使分组无线电网络上的用户能够访问 ARPANET 上的大型服务机器。 当时假设会有其他类型的网络可以互连，尽管局域网尚未出现。

互连现有网络的一种替代方法是设计一个统一的系统，该系统结合了各种不同的传输媒体，即多媒体网络。 虽然这可能允许更高程度的集成，从而获得更好的性能，但人们认为，如果 Internet 要在实际意义上有用，就必须整合当时现有的网络架构。 此外，网络代表了控制的行政边界，该项目的目标是解决将多个单独管理的实体整合到一个公共设施中的问题。

为多路复用选择的技术是分组交换。 可以考虑电路交换等替代方案，但支持的应用程序（例如远程登录）自然由分组交换范式提供服务，并且将在该项目中集成在一起的网络是分组交换网络。 因此，分组交换被接受为 Internet 体系结构的基本组成部分。

这个基本目标的最后一个方面是假设用于互连这些网络的特定技术。 由于存储和转发数据包交换技术（如先前 DARPA 项目 ARPANET 中所展示的）已被很好地理解，因此顶层假设是网络将通过称为网关的 Internet 数据包交换机层互连。

从这些假设中得出了互联网的基本结构：一种分组交换通信设施，其中许多可区分的网络使用称为网关的分组通信处理器连接在一起，网关实现存储和转发分组算法。

## 3 二层目标

上一节中所述的顶级目标包含“有效”一词，但没有提供任何有效互连必须实现的定义。 以下列表总结了为 Internet 体系结构建立的一组更详细的目标。

1. 尽管网络或网关丢失，互联网通信仍必须继续。 
2. 互联网必须支持多种通信服务。
3. Internet 架构必须适应各种网络。
4. Internet 架构必须允许对其资源进行分布式管理。
5. 互联网架构必须具有成本效益。
6. Internet 体系结构必须允许以较低的工作量连接主机。
7. 互联网架构中使用的资源必须负责。

这组目标似乎只不过是所有理想网络功能的清单。 重要的是要理解这些目标是按重要性顺序排列的，如果顺序改变，就会产生完全不同的网络架构。 例如，由于该网络旨在在军事环境中运行，这意味着可能存在敌对环境，因此将生存能力作为首要目标，将问责制作为最后目标。 在战时，人们不太关心使用的资源的详细核算，而是集中任何可用的资源并以一种可操作的方式快速部署它们。 虽然 Internet 的架构师很重视问责制，但在设计的早期阶段这个问题很少受到关注，现在才被考虑。 主要用于商业部署的架构显然会将这些目标放在列表的另一端。

同样，架构具有成本效益的目标显然在列表中，但低于某些其他目标，例如分布式管理或支持各种网络。 其他协议套件，包括一些更流行的商业架构，已经针对特定类型的网络进行了优化，例如由中速电话线构建的长途存储和转发网络，并在这种情况下提供了非常具有成本效益的解决方案， 以换取与其他类型的网络（例如局域网）的处理有些差。

读者应该仔细考虑上面的目标列表，并认识到这不是一个“母性”列表，而是一组优先级，它们强烈地影响了 Internet 架构中的设计决策。 以下部分讨论此列表与 Internet 功能之间的关系。

## 4 面对失败时的生存能力

清单上最重要的目标是互联网应该继续提供通信服务，即使网络和网关出现故障。特别是，这个目标被解释为如果两个实体正在通过 Internet 进行通信，并且某些故障导致 Internet 暂时中断并重新配置以重建服务，那么通信的实体应该能够继续进行通信，而无需重新建立或重置他们对话的高级状态。更具体地说，在传输层的服务接口上，这种架构没有提供任何设施来与传输服务的客户端进行通信，即发送方和接收方之间的同步可能已经丢失。该架构中的一个假设是，除非没有可以实现任何类型通信的物理路径，否则同步永远不会丢失。也就是说，在transport的顶层，只有一个故障，就是全分区。该架构旨在完全掩盖任何瞬态故障。

为了实现这一目标，描述正在进行的对话的状态信息必须受到保护。 状态信息的具体示例将是传输的数据包数量、确认的数据包数量或未完成的流控制权限的数量。 如果架构的较低层丢失了这些信息，他们将无法判断数据是否丢失，应用程序层将不得不应对同步的丢失。 该架构坚持不会发生这种中断，这意味着必须保护状态信息不丢失。

在某些网络架构中，此状态存储在网络的中间分组交换节点中。 在这种情况下，为了保护信息不丢失，必须对其进行复制。 由于复制的分布式特性，确保稳健复制的算法本身很难构建，并且很少有具有分布式状态信息的网络提供任何形式的故障保护。 该架构选择的替代方案是获取此信息并将其收集到网络的端点，即使用网络服务的实体处。 我将这种可靠性方法称为“命运共享”。 命运共享模型表明，如果同时丢失了实体本身，则丢失与实体相关的状态信息是可以接受的。 具体来说，有关传输级同步的信息存储在连接到网络并使用其通信服务的主机中。

与复制相比，命运共享有两个重要的优势。 首先，命运共享可以防止任何数量的中间故障，而复制只能防止一定数量（小于复制副本的数量）。 其次，命运共享比复制更容易设计。

对于生存能力的命运共享方法有两个结果。 首先，中间分组交换节点或网关不能有任何关于正在进行的连接的基本状态信息。 相反，它们是无状态分组交换机，一种有时被称为“数据报”网络设计。 其次，与网络确保数据可靠传递的体系结构相比，对主机的信任度更高。 如果确保数据排序和确认的主机驻留算法失败，则该机器上的应用程序将无法运行。

尽管生存能力是列表中的首要目标，但它仍然仅次于现有网络互连的顶级目标。 单一的多媒体网络设计可能会产生一种更具生存能力的技术。 例如，互联网对网络报告故障的能力做出了非常微弱的假设。因此，互联网被迫使用网络级别的机制来检测网络故障，可能会出现速度较慢且不太具体的错误检测。

## 5 服务类型

互联网架构的第二个目标是它应该在传输服务级别支持多种类型的服务。 不同类型的服务通过对速度、延迟和可靠性等方面的不同要求来区分。 传统的服务类型是双向可靠的数据传输。 该服务有时称为“虚拟电路”服务，适用于远程登录或文件传输等应用程序。 它是 Internet 架构中提供的第一个服务，使用传输控制协议 (TCP) 。很早就认识到即使是此服务也有多种变体，因为远程登录需要一个交付延迟低但对带宽要求低的服务 ，虽然文件传输不太关心延迟，但非常关心高吞吐量。 TCP 试图提供这两种类型的服务。

TCP 的最初概念是它可以足够通用以支持任何需要的服务类型。 然而，随着所需服务的全部范围变得清晰，似乎很难将对所有这些服务的支持构建到一个协议中。

TCP 范围之外的服务的第一个示例是对跨 Internet 调试器 XNET 12 的支持。 由于几个原因，TCP 似乎不适合 XNET 传输。 首先，调试器协议不应该是可靠的。 这个结论可能看起来很奇怪，但在压力或失败的情况下（可能正是需要调试器的时候）要求可靠通信可能会阻止任何通信。 构建一个可以处理任何通过的服务要好得多，而不是坚持发送的每个字节都按顺序传递。 其次，如果 TCP 足够通用，可以处理广泛的客户端，那么它可能有点复杂。 同样，期望在调试环境中支持这种复杂性似乎是错误的，它甚至可能缺乏操作系统中预期的基本服务（例如对计时器的支持）。因此，XNET 被设计为直接在 Internet 提供的数据报服务之上运行 .

另一个不适合 TCP 的服务是数字化语音的实时传送，这是支持指挥和控制应用程序的电话会议方面所必需的。在实时数字语音中，主要要求不是可靠的服务，而是最小化和平滑数据包传递延迟。应用层将模拟语音数字化，将生成的比特打包，并定期通过网络发送出去。它们必须定期到达接收器，以便转换回模拟信号。如果数据包没有按预期到达，就不可能实时重组信号。关于延迟变化控制的一个令人惊讶的观察是，网络中最严重的延迟来源是提供可靠传递的机制。典型的可靠传输协议通过请求重新传输，并延迟任何后续数据包的传递，直到丢失的数据包被重新传输来响应丢失的数据包。然后它按顺序传递该数据包和所有剩余的数据包。发生这种情况时的延迟可能是网络往返传递时间的许多倍，并且可能会完全破坏语音重组算法。相比之下，处理偶尔丢失的数据包非常容易。丢失的语音可以简单地用短时间的沉默代替，这在大多数情况下不会影响听者对语音的可理解性。如果确实如此，则可能会发生高级错误纠正，并且听众可以要求说话者重复损坏的短语。

因此，在 Internet 架构开发的相当早的时候，就决定需要多种传输服务，并且架构必须容忍希望限制可靠性、延迟或带宽的传输，至少。

这个目标导致 TCP 和 IP，原本是架构中的单一协议，被分成两层。 TCP 提供了一种特定类型的服务，即可靠的序列数据流，而 IP 试图提供一个基本的构建块，可以从中构建各种类型的服务。 这个构建块是数据报，它也被用来支持生存能力。 由于不能保证与数据报的传递相关的可靠性，而是“尽力而为”，因此可以从数据报中构建可靠的服务（通过在更高级别上进行确认和重传），或另一种服务，它牺牲可靠性换取低延迟。 创建用户数据报协议 (UDP) 是为了向 Internet 的基本数据报服务提供应用级接口。

该架构不希望假设底层网络本身支持多种类型的服务，因为这将违反使用现有网络的目标。 相反，希望是可以使用主机和网关内的算法从基本数据报构建块构建多种类型的服务。 例如，（尽管在大多数当前实现中没有这样做）可以获取与受控延迟相关但服务不可靠的数据报，并将它们放在传输队列的头部，除非它们的生命周期已过期，在这种情况下它们将被丢弃； 而与可靠流相关的数据包将被放置在队列的后面，但永远不会被丢弃，无论它们在网络中存在多长时间。

事实证明，在没有底层网络明确支持的情况下，提供多种类型的服务比最初希望的要困难得多。 最严重的问题是，为一种特定类型的服务设计的网络不够灵活，无法支持其他服务。 最常见的情况是，网络的设计假设是它应该提供可靠的服务，并且会在产生可靠服务的过程中注入延迟，无论是否需要这种可靠性。 例如，X.25 定义的接口行为意味着可靠交付，并且没有办法关闭此功能。 因此，尽管 Internet 在 X.25 网络上成功运行，但它无法在该上下文中提供所需的类型服务可变性。 其他具有内在数据报服务的网络在它们允许的服务类型方面更加灵活，但这些网络不太常见，尤其是在长途环境中。

## 6 各种网络

对于 Internet 架构的成功而言，它能够整合和利用各种网络技术，包括军事和商业设施，这一点非常重要。互联网架构在实现这一目标方面非常成功；它在各种各样的网络上运行，包括长途网络（ARPANET 本身和各种 X.25 网络）、局域网（以太网、环网等）、广播卫星网络（DARPA 大西洋卫星网络 每秒 64 千比特和 DARPA 实验宽带卫星网络，在美国以每秒 3 兆比特运行），分组无线电网络（DARPA 分组无线电网络，以及一个实验性的英国分组无线电网络和由业余无线电操作员），各种串行链路，从每秒 1200 比特的异步连接到 T1 链路，以及各种其他自组织设施，包括计算机间总线和其他网络套件的更高层提供的传输服务，例如作为 IBM 的 HASP。

Internet 体系结构通过对网络将提供的功能做出最少的假设来实现这种灵活性。 基本假设是网络可以传输数据包或数据报。 数据包必须具有合理的大小，至少 100 字节，并且应该以合理但不完美的可靠性交付。 如果网络不仅仅是点对点链接，则网络必须具有某种合适的寻址形式。

有许多服务明确没有从网络中假设。这些包括可靠或有序的交付、网络级广播或多播、传输数据包的优先级排序、对多种服务的支持以及故障、速度或延迟的内部感知。如果需要这些服务，那么为了适应 Internet 中的网络，网络必须直接支持这些服务，或者网络接口软件提供增强功能以在网络端点模拟这些服务。人们认为这是一种不受欢迎的方法，因为必须为每个网络和每个网络的每个主机接口重新设计和重新实现这些服务。通过在传输过程中设计这些服务，例如通过 TCP 进行可靠交付，工程必须只完成一次，并且每个主机必须只完成一次实施。之后，新网络的接口软件的实现通常非常简单。

## 7 其他目标

到目前为止讨论的三个目标是对架构设计产生最深远影响的目标。其余的目标，因为它们的重要性较低，可能不太有效地实现，或者没有完全设计。允许对 Internet 进行分布式管理的目标在某些方面肯定已经实现。例如，并非互联网中的所有网关都由同一个机构实施和管理。在已部署的 Internet 中有几个不同的管理中心，每个管理中心都运行网关的一个子集，并且有一个两层路由算法，允许来自不同管理部门的网关交换路由表，即使它们彼此不完全信任，以及各种在单个管理中的网关之间使用的私有路由算法。类似地，管理网关的各种组织不一定是管理网关所连接的网络的相同组织。

另一方面，当今互联网的一些最重要的问题与缺乏足够的分布式管理工具有关，尤其是在路由领域。 在当前运营的大型互联网中，路由决策需要受到资源使用策略的约束。 今天，这只能以非常有限的方式完成，这需要手动设置路由表。 这很容易出错，同时也不够强大。 未来几年互联网架构中最重要的变化可能是开发新一代的多部门资源管理工具。

很明显，在某些情况下，Internet 架构在使用昂贵的通信资源方面的成本效益不如更量身定制的架构。 Internet 数据包的报头相当长（典型的报头为 40 字节），如果发送短数据包，这种开销是显而易见的。当然，更糟糕的情况是单字符远程登录数据包，它携带 40 字节的报头和 1 字节的数据。实际上，任何协议套件都很难声称这些交换以合理的效率进行。在另一个极端，用于文件传输的大数据包（可能包含 1,000 字节数据）的报头开销仅为 4%。

效率低下的另一个可能原因是丢失数据包的重传。由于 Internet 不坚持在网络级别恢复丢失的数据包，因此可能需要将丢失的数据包从 Internet 的一端重新传输到另一端。这意味着重新传输的数据包可能会再次穿过几个中间网络，而网络级别的恢复不会产生这种重复流量。这是上面讨论的从端点提供服务的决定所产生的权衡的一个例子。网络接口代码要简单得多，但整体效率可能更低。但是，如果重传率足够低（例如，1%），那么增量成本是可以容忍的。作为纳入架构的网络的粗略经验法则，每 100 个数据包丢失一个数据包是相当合理的，但如果需要这种类型的服务，每 10 个数据包丢失一个数据包表明需要增强网络的可靠性。

将主机连接到 Internet 的成本可能略高于其他架构，因为提供所需服务类型的所有机制，例如确认和重传策略，都必须在主机中而不是在网络中实现。最初，对于不熟悉协议实现的程序员来说，这样做似乎有些艰巨。实现者尝试了诸如将传输协议移至前端处理器之类的事情，其想法是协议将只实现一次，而不是为每种类型的主机再次实现。然而，这需要发明一种主机到前端协议，有些人认为该协议的实现几乎与原始传输协议一样复杂。随着协议经验的增加，与在主机内实现协议套件相关的焦虑似乎正在减少，并且现在可用于各种机器，包括个人计算机和其他计算资源非常有限的机器。

使用主机驻留机制引起的一个相关问题是该机制的不良实施可能会损害网络以及主机。这个问题是可以容忍的，因为最初的实验涉及有限数量的可以控制的主机实现。然而，随着互联网使用的增长，这个问题偶尔会以严重的方式浮出水面。在这方面，鲁棒性目标导致命运共享方法导致主机驻留算法，如果主机行为不端，则会导致鲁棒性损失。

最后一个目标是问责制。事实上，Cerf 和 Kahn 在第一篇论文中将记账作为协议和网关的一项重要功能进行了讨论。然而，目前，互联网架构包含很少的工具来计算数据包流。这个问题现在才被研究，因为架构的范围正在扩大到包括非军事消费者，他们非常关心理解和监控互联网内资源的使用情况。

## 8 架构和实现

前面的讨论清楚地表明，互联网架构的目标之一是在所提供的服务中提供广泛的灵活性。可以使用不同的传输协议来提供不同类型的服务，并且可以合并不同的网络。换句话说，该体系结构非常努力地不限制互联网可以提供的服务范围。反过来，这意味着要理解 Internet 的特定实现可以提供的服务，必须不看架构，而要看特定主机和网关内软件的实际工程，以及特定的已纳入的网络。我将使用术语“实现”来描述一组特定的网络、网关和主机，它们在 Internet 体系结构的上下文中连接在一起。在他们提供的服务中，实现可能会相差几个数量级。实现是由每秒 1200 比特的电话线和仅具有大于每秒 1 兆比特的网络构建的。显然，人们对这些实现的吞吐量预期相差几个数量级。类似地，一些 Internet 实现的延迟以数十毫秒为单位，而另一些则以秒为单位。某些应用程序（例如实时语音）在这两种实现方式中的工作方式根本不同。一些网络已经被过度设计，因此网关和路径中有很大的冗余。这些互联网是可以生存的，因为资源可以在故障后重新配置。其他 Internet 实现，通过实现单点连接来降低成本，因此故障可能会将 Internet 分成两半。

Internet 体系结构通过设计来容忍这种多样性的实现。 然而，它给特定实现的设计者留下了大量的工程工作要做。 这种架构开发的主要挑战之一是了解如何为实现的设计者提供指导，指导将实现的工程与将产生的服务类型联系起来。 例如，设计者必须回答以下类型的问题。 如果整个服务要提供一定速率的吞吐量，底层网络中必须有什么样的带宽？ 给定这种实现中可能出现故障的特定模型，应该在实现中设计什么样的冗余？

大多数已知的网络设计辅助工具似乎对回答这类问题没有帮助。例如，协议验证器有助于确认协议符合规范。然而，这些工具几乎从不处理性能问题，而这对于服务类型的概念至关重要。相反，它们处理的是协议相对于规范的逻辑正确性这一更受限制的想法。虽然验证逻辑正确性的工具在规范和实现阶段都是有用的，但它们无助于解决经常出现的与性能相关的严重问题。一个典型的实施经验是，即使在证明了逻辑正确性之后，仍会发现可能导致性能下降一个数量级的设计错误。对这个问题的探索得出的结论是，困难通常不是出现在协议本身，而是出现在协议运行的操作系统上。在这种情况下，很难在架构规范的上下文中解决该问题。但是，我们仍然强烈认为有必要给予实施者指导。我们今天继续与这个问题作斗争。

另一类设计辅助是模拟器，它采用特定的实现并探索它可以在各种负载下提供的服务。 还没有人尝试构建一个模拟器，它考虑到网关实现、主机实现和网络性能的广泛可变性，这是人们在可能的 Internet 实现中看到的。 因此，大多数 Internet 实现的分析都是在信封背面完成的。 对 Internet 架构的目标结构的评论是，如果由知识渊博的人进行粗略分析，通常就足够了。 特定 Internet 实现的设计者通常不太关心获得最后 5% 的线路利用率，而是知道在目前手头的资源情况下是否可以实现所需的服务类型。

架构和性能之间的关系是一个极具挑战性的关系。 互联网架构的设计者非常强烈地认为，只关注逻辑正确性而忽视性能问题是一个严重的错误。 但是，他们在将架构内性能约束的任何方面形式化时遇到了很大的困难。 之所以出现这些困难，一方面是因为架构的目标不是限制性能，而是允许可变性，其次（也许更根本的是），因为似乎没有有用的正式工具来描述性能。

这个问题尤其严重，因为 Internet 项目的目标是生成规范文件，这些文件将成为军用标准。政府承包的一个众所周知的问题是，不能期望承包商满足任何不属于采购标准的标准。因此，如果 Internet 关注性能，则必须将性能要求纳入采购规范。发明限制性能的规范是微不足道的，例如指定实现必须能够每秒传递 1,000 个数据包。然而，这种约束不能成为架构的一部分，因此执行采购的个人必须认识到必须将这些性能约束添加到规范中，并正确指定它们以实现提供所需的服务类型。我们不知道如何为执行此任务的人员提供架构指导。

## 9 数据包

互联网的基本架构特征是使用数据报作为跨底层网络传输的实体。正如本文所建议的，数据报在架构中很重要有几个原因。首先，它们消除了对中间交换节点内连接状态的需求，这意味着互联网可以在发生故障后重建而无需考虑状态。其次，数据报提供了一个基本的构建块，通过它可以实现各种类型的服务。与通常意味着固定类型的服务的虚拟电路相比，数据报提供了更基本的服务，端点可以适当地组合这些服务来构建所需的服务类型。第三，数据报代表了最小的网络服务假设，它允许将各种各样的网络结合到各种互联网实现中。使用数据报的决定是一个非常成功的决定，它使互联网能够非常成功地实现其最重要的目标。

通常与数据报相关的一个错误假设是，数据报的动机是支持更高级别的服务，该服务本质上等同于数据报。 换句话说，有时建议提供数据报，因为应用程序需要的传输服务是数据报服务。 事实上，这种情况很少见。 虽然 Internet 中的某些应用程序（例如对日期服务器或名称服务器的简单查询）使用基于不可靠数据报的访问方法，但 Internet 中的大多数服务都希望使用比简单数据报更复杂的传输模型。 一些服务希望提高可靠性，一些希望平滑和缓冲延迟，但几乎所有的服务都期望比数据报更复杂。 重要的是要了解数据报在这方面的作用是作为构建块，而不是作为服务本身。

## 10 TCP

在 TCP 的开发过程中有几个有趣和有争议的设计决策，而且 TCP 本身在成为一个相当稳定的标准之前也经历了几个主要版本。 其中一些设计决策，例如窗口管理和端口地址结构的性质，在作为 TCP 协议手册的一部分发布的一系列实施说明中进行了讨论。但是有时缺乏决策的动机。 在本节中，我试图捕捉一些 TCP 部分的早期原因。 本节必然是不完整的； 完整回顾 TCP 本身的历史需要另一篇如此篇幅的论文。

最初的 ARPANET 主机到主机协议提供了基于字节和数据包的流量控制。 这似乎过于复杂，TCP 的设计者认为只有一种监管形式就足够了。 选择是规范字节的传递，而不是数据包。 因此，TCP 中的流量控制和确认基于字节数而不是数据包数。 实际上，在 TCP 中，数据的打包没有意义。

这个决定是出于几个考虑，其中一些变得无关紧要，而另一些则比预期的更重要。 确认字节的一个原因是允许将控制信息插入字节的序列空间，以便可以确认控制和数据。 放弃了对序列空间的使用，取而代之的是处理每个控制消息的特殊技术。 虽然最初的想法具有吸引人的普遍性，但它在实践中造成了复杂性。

字节流的第二个原因是允许 TCP 数据包在必要时被分解成更小的数据包，以便通过具有小数据包大小的网络。 但是这个功能在IP从TCP分裂出来的时候被移到了IP层，IP被迫发明了一种不同的分片方法。

确认字节而不是数据包的第三个原因是，如果需要重新传输数据，则允许在发送主机中将许多小数据包聚集成一个更大的数据包。 目前尚不清楚这种优势是否重要。 结果很关键。 诸如 UNIX 等具有基于单字符交互的内部通信模型的系统通常会发送许多数据包，其中包含一个字节的数据。 （有人可能会从网络的角度争辩说这种行为很愚蠢，但它是现实的，也是交互式远程登录的必要条件。）经常观察到这样的主机可能会产生大量包含一个字节数据的数据包，这 会比慢速主机处理它们的速度快得多。 结果是丢包和重传。

如果重传的是原始数据包，那么每次重传都会重复同样的问题，对性能的影响是无法容忍的，以至于无法运行。 但是由于字节被收集到一个数据包中进行重传，重传以一种更有效的方式发生，允许实际操作。

另一方面，字节的确认可以被视为首先造成了这个问题。 如果流量控制的基础是数据包而不是字节，那么这种洪水可能永远不会发生。 但是，如果发送小数据包，则数据包级别的控制会严重限制吞吐量。 如果接收主机指定要接收的数据包数量，但不知道每个数据包的字节数，则接收到的实际数据量可能会相差 1000 倍，具体取决于发送主机是否放入一千字节 每个数据包。

回想起来，正确的设计决策可能是，如果 TCP 要提供对各种服务的有效支持，则必须对数据包和字节进行规范，就像在原始 ARPANET 协议中所做的那样。

与字节流相关的另一个设计决策是 End-Of-Letter 标志或 EOL。 这现在已经从协议中消失了，取而代之的是 Push 标志或 PSH。 EOL 最初的想法是将字节流分解为记录。 它是通过将来自单独记录的数据放入单独的数据包中来实现的，这与在重传时合并数据包的想法不兼容。 因此，EOL 的语义被更改为一种较弱的形式，仅意味着流中到此点的数据是一个或多个完整的应用程序级元素，这应该会导致 TCP 或网络中的任何内部缓冲的刷新。 通过说“一个或多个”而不是“完全一个”，可以将几个组合在一起并保持在重组时压缩数据的目标。 但是较弱的语义意味着各种应用程序必须发明一种特殊机制来在数据流之上分隔记录。

在 EOL 语义的这种演变中，有一种鲜为人知的中间形式，这引起了很大的争论。 根据主机的缓冲策略，TCP 的字节流模型在一种不太可能的情况下会引起很大的问题。 考虑一个主机，其中传入的数据被放入一系列固定大小的缓冲区中。 当缓冲区已满或收到 EOL 时，会将缓冲区返回给用户。 现在考虑一个乱序数据包到达的情况，该数据包非常乱，超出了当前缓冲区。 现在进一步考虑，在接收到这个乱序数据包后，带有 EOL 的数据包会导致当前缓冲区仅部分满返回给用户。 由于缓冲区中返回给用户的空字节，此特定的操作序列会导致下一个缓冲区中的乱序数据位于错误的位置。 处理这在主机中产生的簿记问题似乎是不必要的。

为了解决这个问题，建议 EOL 应该“用完”所有序列空间，直到下一个值是零模缓冲区大小。 换句话说，有人提出 EOL 应该是一个将字节流映射到主机缓冲区管理的工具。这个想法在当时并不受欢迎，因为它似乎过于临时性，并且似乎只有一个主机 有这个问题。 * 回想起来，在 TCP 中加入一些将序列空间和主机的缓冲区管理算法相关联的方法可能是正确的想法。 当时，设计师只是缺乏洞察力，无法以足够通用的方式完成这项工作。

## 11 结论

就其优先事项而言，互联网架构非常成功。 这些协议广泛用于商业和军事环境，并催生了许多类似的架构。 同时，它的成功表明，在某些情况下，设计师的优先级与实际用户的需求不匹配。 需要更加关注分管地区的会计、资源管理和运营等事项。

虽然数据报在解决 Internet 最重要的目标方面发挥了很好的作用，但当我们试图解决一些在优先级列表中更靠后的目标时，它就没有那么好用了。 例如，资源管理和问责制的目标已被证明在数据报的背景下难以实现。 正如上一节所讨论的，大多数数据报是从源到目的地的某些数据包序列的一部分，而不是应用程序级别的孤立单元。 但是，网关不能直接看到这个序列的存在，因为它被迫孤立地处理每个数据包。 因此，必须对每个数据包分别进行资源管理决策或计费。 将数据报模型强加于 Internet 层已经剥夺了该层可用于实现这些目标的重要信息来源。

这表明下一代架构可能有比数据报更好的构建块。这个构建块的一般特征是它可以识别从源到目的地的一系列数据包，而无需假设该服务具有任何特定类型的服务。我用“流”这个词来描述这个构建块。网关必须具有流状态以记住通过它们的流的性质，但状态信息对于维护与流相关联的所需服务类型并不重要。相反，该类型的服务将由端点强制执行，端点将定期发送消息以确保正确类型的服务与流相关联。这样，与流相关的状态信息可能会在崩溃中丢失，而不会永久中断正在使用的服务功能。我将这个概念称为“软状态”，它很可能使我们能够实现生存性和灵活性的主要目标，同时更好地处理资源管理和问责制问题。探索替代构建块构成了 DARPA 互联网计划的当前研究方向之一。

## 致谢——来自历史的视角

不可能承认互联网项目的所有贡献者； 在 15 年的发展中，实际上已经有数百人：设计师、实施者、作家和评论家。 事实上，一个重要的话题，可能本身就值得一篇论文，是管理这个项目的过程。 参与者来自大学、研究实验室和企业，他们（在一定程度上）团结起来以实现这一共同目标。

TCP 的最初愿景来自 Robert Kahn 和 Vinton Cerf，他们在 1973 年非常清楚地看到，具有合适特性的协议如何成为将各种新兴网络技术结合在一起的粘合剂。 从他们在 DARPA 的职位开始，他们在项目的早期指导该项目，直至 TCP 和 IP 成为国防部的标准。

本文作者于 70 年代中期加入该项目，并于 1981 年接手 TCP/IP 的架构责任。他要感谢所有与他一起工作的人，特别是那些花时间在本文中重建一些丢失的历史的人。