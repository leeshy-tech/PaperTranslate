# OpenFlow: Enabling Innovation in Campus Networks

OpenFlow:实现校园网络的创新

## 摘要

本白皮书提出了 OpenFlow：一种供研究人员在他们每天使用的网络中运行实验协议的方法。 OpenFlow 基于以太网交换机，具有内部流表和用于添加和删除流条目的标准化接口。我们的目标是鼓励网络供应商将 OpenFlow 添加到他们的交换机产品中，以部署在大学校园骨干网和配线间中。我们认为 OpenFlow 是一种务实的折衷方案：一方面，它允许研究人员以统一的方式以线速和高端口密度在异构交换机上运行实验；另一方面，供应商不需要公开其交换机的内部工作原理。除了允许研究人员在现实世界的流量设置中评估他们的想法外，OpenFlow 还可以作为一个有用的校园组件，用于提议的大规模测试平台（如 GENI）。斯坦福大学的两座建筑物将很快使用商用以太网交换机和路由器运行 OpenFlow 网络。我们将努力鼓励在其他学校部署；我们鼓励您也考虑在您的大学网络中部署 OpenFlow。

## 1. 对可编程网络的需求

网络已成为我们企业、家庭和学校关键基础设施的一部分。 对于网络研究人员来说，这一成功既是福也是祸。 他们的工作更相关，但他们产生影响的机会更渺茫。 任何给定网络创新对现实世界影响的减少是因为设备和协议的庞大安装基础，以及不愿尝试生产流量，这为新想法的进入设置了极高的障碍。 今天，几乎没有实用的方法可以在足够现实的环境（例如，大规模承载真实流量）中试验新的网络协议（例如，新的路由协议或 IP 的替代方案）以获得广泛部署所需的信心。 结果是来自网络研究社区的大多数新想法都未经尝试和测试。 因此，人们普遍认为网络基础设施已经“僵化”。

认识到这个问题后，网络社区正在努力开发可编程网络，例如 GENI [1]，这是一个提议的全国性研究机构，用于试验新的网络架构和分布式系统。 这些可编程网络需要可编程交换机和路由器（使用虚拟化）可以同时处理多个隔离实验网络的数据包。 例如，在 GENI 中，设想研究人员将在整个网络中分配一块资源，包括一部分网络链路、数据包处理元素（例如路由器）和终端主机； 研究人员对他们的切片进行编程，使其按照他们的意愿行事。 一个切片可以跨越骨干网、接入网络、大学校园、工业研究实验室，并包括配线间、无线网络和传感器网络。

虚拟化可编程网络可以降低新想法的进入门槛，提高网络基础设施的创新速度。 但全国性设施的计划雄心勃勃（而且成本高昂），部署起来需要数年时间。 本白皮书关注一个离家更近的短期问题：作为研究人员，我们如何在校园网络中进行实验？ 如果我们能弄清楚这个问题，我们可以很快开始并将该技术扩展到其他校园，以造福整个社区。

为迎接这一挑战，需要回答几个问题，包括：在早期，大学网络管理员如何将实验设备（交换机、路由器、接入点等）融入他们的网络？ 研究人员将如何以不干扰依赖它的其他人的方式控制其本地网络的一部分？ 网络交换机究竟需要哪些功能才能进行实验？ 我们的目标是提出一种新的交换机功能，可以帮助将可编程性扩展到大学校园的配线间。

一种我们不采用的方法是说服商业“名牌”设备供应商在他们的交换机和路由器上提供一个开放的、可编程的、虚拟化平台，以便研究人员可以部署新协议，而网络管理员可以放心，设备得到很好的支持。这种结果在短期内不太可能发生。商用交换机和路由器通常不提供开放的软件平台，更不用说提供虚拟化其硬件或软件的方法了。商业组网的标准化的外部接口很窄（即只是数据包转发），并且隐藏了交换机的所有内部灵活性。内部结构因供应商而异，没有可供研究人员试验新想法的标准平台。此外，可以理解的是，网络设备供应商对在他们的盒子里开放接口感到紧张：他们花了数年时间部署和调整脆弱的分布式协议和算法，他们担心新的实验会导致网络崩溃。当然，开放平台降低了新竞争对手的进入门槛。

一些开放的软件平台已经存在，但没有我们需要的性能或端口密度。 最简单的示例是具有多个网络接口和操作系统的 PC。 所有著名的操作系统都支持接口之间的数据包路由，并且存在路由协议的开源实现（例如，作为 Linux 发行版的一部分，或来自 XORP [2]）； 在大多数情况下，可以修改操作系统以几乎任何方式处理数据包（例如，使用 Click [3]）。 当然，问题在于性能：一台 PC 既不能支持大学布线室所需的端口数量（每个盒子需要 100 多个端口的扇出），也不能支持数据包处理性能（布线室交换机处理超过 100Gbits /s 的数据，而典型的 PC 难以超过 1Gbit/s；两者之间的差距正在扩大）。

具有用于线速处理的专用硬件的现有平台也不太适合大学布线室。例如，华盛顿大学正在开发一种名为 Supercharged PlanetLab Platform [4] 的基于 ATCA 的虚拟化可编程路由器，它可以使用网络处理器以线速同时处理来自多个接口的数据包。从长远来看，这种方法很有前景，但目前针对的是大型交换中心，而且对于在大学布线室中广泛部署而言过于昂贵。另一个极端是针对教学和研究实验室的 NetFPGA [5]。 NetFPGA 是一款低成本的 PCI 卡，带有用于处理数据包的用户可编程 FPGA，以及 4 个千兆以太网端口。 NetFPGA 仅限于四个网络接口——不足以在配线间中使用。

因此，商业解决方案过于封闭和不灵活，研究解决方案要么性能不足或扇出，要么过于昂贵。具有完全通用性的研究解决方案似乎不太可能克服其性能或成本限制。一种更有希望的方法是在通用性上妥协并寻求一定程度的开关灵活性，即：

- 适合高性能和低成本的实施。
- 能够支持广泛的研究。
- 确保将实验流量与生产流量隔离开来。
- 符合供应商对封闭平台的需求。 

本文描述了 OpenFlow 交换机 — 一种最初尝试满足这四个目标的规范。

## 2. OpenFlow交换机

基本思想很简单：我们利用大多数现代以太网交换机和路由器包含以线速运行的流表（通常由 TCAM 构建）来实现防火墙、NAT、QoS 和收集统计数据。虽然每个供应商的流表都不同，但我们已经确定了一组有趣的通用功能，可在许多交换机和路由器中运行。

OpenFlow 利用了这组通用功能。 OpenFlow 提供了一个开放协议来对不同交换机和路由器中的流表进行编程。网络管理员可以将流量划分为生产和研究流。研究人员可以通过选择他们的数据包遵循的路线和他们接收的处理来控制他们自己的流量。通过这种方式，研究人员可以尝试新的路由协议、安全模型、寻址方案，甚至是 IP 的替代方案。在同一个网络上，生产流量被隔离并以与今天相同的方式进行处理。

OpenFlow 交换机的数据路径由流表和与每个流条目关联的操作组成。 OpenFlow 交换机支持的操作集是可扩展的，但下面我们描述了所有交换机的最低要求。为了实现高性能和低成本，数据路径必须具有精心规定的灵活性。这意味着放弃指定任意处理每个数据包的能力，并寻求更有限但仍然有用的操作范围。因此，在本文后面，为所有 OpenFlow 交换机定义一组基本的必需操作。

一个 OpenFlow 交换机至少由三部分组成：（1）流表，与每个流条目相关联的动作，用于告诉交换机如何处理流，（2）将交换机连接到远程控制程序（称为控制器）的安全通道，它在控制器和交换机之间发送命令和数据包，使用 (3) OpenFlow 协议，该协议为控制器与交换机通信提供了一种开放和标准的方式。 通过指定一个标准接口（开放流协议），流表中的条目可以通过该接口在外部定义，开放流交换机避免了研究人员对交换机进行编程的需要。

将交换机归类为不支持正常第2层和第3层处理的**专用OpenFlow交换机**，以及启用OpenFlow的**通用商用以太网交换机和路由器**(OpenFlow协议和接口已作为新功能添加到这些交换机和路由器中)，这很有用。

**专用OpenFlow交换机。**专用 OpenFlow 交换机是在端口之间转发数据包的哑数据路径元素，由远程控制程序定义。 图 1 显示了 OpenFlow 交换机的示例。

在这种情况下，流被广泛定义，并且仅受流表的特定实现的能力的限制。 例如，一个流可以是一个 TCP 连接，或来自特定 MAC 地址或 IP 地址的所有数据包，或具有相同 VLAN 标记的所有数据包，或来自同一交换机端口的所有数据包。 对于涉及非 IPv4 数据包的实验，可以将流定义为与特定（但非标准）标头匹配的所有数据包。

每个流条目都有一个与之关联的简单动作； 三个基本的（所有专用 OpenFlow 交换机都必须支持）是：

1. 将此流的数据包转发到给定端口（或多个端口）。 这允许数据包通过网络进行路由。 在大多数交换机中，这预计将在线性速率下发生。
2. 封装此流的数据包并将其转发给控制器。 数据包被传递到安全通道，在那里它被封装并发送到控制器。 通常用于新流中的第一个数据包，因此控制器可以决定是否应将流添加到流表中。 或者在某些实验中，它可以用于将所有数据包转发到控制器进行处理。
3. 丢弃该流的数据包。 可用于安全、遏制拒绝服务攻击或减少来自终端主机的虚假广播发现流量。

Flow-Table 中的条目具有三个字段：（1）定义流的数据包头，（2）定义应如何处理数据包的操作，以及（3）统计数据，跟踪数据包的数量。 每个流的数据包和字节，以及自最后一个数据包与流匹配的时间（以帮助删除非活动流）。

在第一代“Type 0”交换机中，流标头是一个 10 元组，如表 1 所示。TCP 流可以由所有十个字段指定，而 IP 流可能不包括其定义中的传输端口。 每个标头字段可以是通配符，以允许聚合流，例如仅定义 VLAN ID 的流将应用于特定 VLAN 上的所有流量。

OpenFlow Switch 的详细要求由 OpenFlow Switch Specification [6] 定义。

**OpenFlow使能的交换机。**一些商用交换机、路由器和接入点将通过添加流表、安全通道和 OpenFlow 协议来增强 OpenFlow 功能（我们在第 5 节中列出了一些示例）。 通常，流表将重用现有硬件，例如 TCAM； 安全通道和协议将被移植以在交换机的操作系统上运行。 图 2 显示了支持 OpenFlow 的商业交换机和接入点网络。 在这个例子中，所有的流表都由同一个控制器管理； OpenFlow 协议允许交换机由两个或多个控制器控制，以提高性能或鲁棒性。

我们的目标是使实验能够在现有的生产网络中与常规流量和应用程序一起进行。 因此，为了赢得网络管理员的信任，启用 OpenFlow 的交换机必须将实验流量（由 Flow Table 处理）与将由交换机的正常第 2 层和第 3 层管道处理的生产流量隔离开来。 有两种方法可以实现这种分离。 一种是添加第四个动作：

4. 通过交换机的正常处理管道转发此流的数据包。

另一种是为实验和生产流量定义单独的 VLAN 集。 这两种方法都允许交换机以通常的方式处理不属于实验的正常生产流量。 所有启用 OpenFlow 的交换机都需要支持一种方法或另一种方法； 有些人会同时支持两者。

**额外的特性。**如果交换机支持报头格式和上面提到的四个基本操作（在 OpenFlow 交换机规范中有详细说明），那么我们称其为“Type 0”交换机。 我们预计许多交换机将支持其他操作，例如重写部分数据包头（例如，用于 NAT，或混淆中间链路上的地址），并将数据包映射到优先级类别。 同样，一些流表将能够匹配数据包头中的任意字段，从而可以使用新的非 IP 协议进行实验。 随着一组特定功能的出现，我们将定义一个“Type 1”开关。

**控制器。**控制器代表实验从流表中添加和删除流条目。 例如，静态控制器可能是在 PC 上运行的简单应用程序，用于在实验期间静态建立流以互连一组测试计算机。 在这种情况下，流类似于当前网络中的 VLAN——提供一种简单的机制来将实验流量与生产网络隔离。 从这个角度来看，OpenFlow 是 VLAN 的泛化。

人们还可以想象更复杂的控制器，它们会随着实验的进行动态地添加/删除流。 在一个使用模型中，研究人员可以控制整个 OpenFlow 交换机网络，并可以自由决定如何处理所有流。 更复杂的控制器可能支持多个研究人员，每个研究人员具有不同的帐户和权限，使他们能够在不同的流程集上运行多个独立的实验。 识别为在特定研究人员控制下的流（例如，通过在控制器中运行的策略表）可以传送到研究人员的用户级控制程序，然后由该程序决定是否应将新的流条目添加到交换机网络 .

## 3. 使用OpenFlow

作为一个如何使用 OpenFlow 交换机的简单示例，假设 Amy（一名研究人员）发明了 Amy-OSPF 作为一种新的路由协议来替代 OSPF。她想在 OpenFlow 交换机网络中尝试她的协议，而无需更改任何终端主机软件。 Amy-OSPF 将在控制器中运行；每次新的应用程序流启动时，AmyOSPF 都会通过一系列 OpenFlow 交换机选择一条路由，并在该路径上的每个交换机中添加一个流条目。在她的实验中，Amy 决定对从她自己的台式 PC 进入 OpenFlow 网络的流量使用 Amy-OSPF，这样她就不会为其他人中断网络。为此，她将一个流定义为通过她的 PC 所连接的交换机端口进入 OpenFlow 交换机的所有流量，并添加一个带有“封装并将所有数据包转发到控制器”操作的流条目。当她的数据包到达控制器时，她的新协议会选择一个路由，并为所选路径上的每个交换机添加一个新的流条目（用于应用程序流）。当后续数据包到达交换机时，流表会快速（并以线速）处理它们。

关于随着实验的进行动态添加和删除流的控制器的性能、可靠性和可扩展性，有一些合理的问题要问：这样的集中式控制器能否足够快地处理新流和对流开关进行编程？当控制器发生故障时会发生什么？在某种程度上，这些问题在 Ethane 原型的背景下得到解决，该原型使用简单的流量交换机和中央控制器 [7]。初步结果表明，基于低成本台式 PC 的 Ethane 控制器每秒可以处理超过 10,000 个新流量，足以满足大型大学校园的需求。当然，新流的处理速度将取决于研究人员实验所需的处理复杂性。但这让我们相信可以进行有意义的实验。通过使控制器（和实验）无状态，可以实现可扩展性和冗余，允许在多个单独的设备上进行简单的负载平衡。

## 3.1 生产网络上的实践

很有可能，Amy正在许多其他人使用的网络中测试她的新协议。 因此，我们希望网络具有两个额外的属性： 

1. 属于 Amy 以外的用户的数据包应该使用在交换机或路由器中运行的标准且经过测试的路由协议进行路由，该协议运行在“知名品牌”供应商的交换机或路由器中。 
2. Amy 应该只能为她的流量或她的网络管理员允许她控制的任何流量添加流条目。

属性 1 是通过启用 OpenFlow 的交换机实现的。在 Amy 的实验中，所有不是来自 Amy 的 PC 的数据包的默认操作可能是通过正常的处理管道转发它们。 Amy 自己的数据包将直接转发到传出端口，而无需经过正常管道处理。

属性 2 取决于控制器。控制器应该被视为一个平台，使研究人员能够进行各种实验，而Property 2的限制可以通过适当使用权限或其他方式来限制单个研究人员控制流入口的权力来实现。这些类似权限的机制的确切性质将取决于控制器的实现方式。我们预计会出现各种各样的控制器。作为控制器具体实现的一个例子，一些作者正在开发一种称为 NOX 的控制器，作为 Ethane 工作的后续[8]。通过将 GENI 管理软件扩展到 OpenFlow 网络，可能会出现一个完全不同的控制器。

## 3.2 更多实例

与任何实验平台一样，这组实验将超过我们可以预先想到的那些——OpenFlow 网络中的大多数实验还有待考虑。 在这里，为了说明，我们提供了一些示例，说明如何使用支持 OpenFlow 的网络来试验新的网络应用程序和架构。

**实验1：网络管理和接入控制。**我们将使用 Ethane 作为我们的第一个示例 [7]，因为它是启发 OpenFlow 的研究。事实上，OpenFlow 交换机可以被认为是 Ethane 的数据路径交换机的推广。 Ethane 使用了一种特定的控制器实现方式，适用于网络管理和控制，用于管理流量的准入和路由。 Ethane 的基本思想是允许网络管理员在中央控制器中定义网络范围的策略，通过为每个新流做出准入控制决策直接执行该策略。控制器根据一组规则检查新流，例如“客人可以使用 HTTP 进行通信，但只能通过 Web 代理”或“不允许 VoIP 电话与笔记本电脑通信”。控制器通过管理名称和地址之间的所有绑定来将数据包与其发送者相关联——它实质上接管了 DNS、DHCP 并在所有用户加入时对其进行身份验证，跟踪他们连接到哪个交换机端口（或接入点）。可以设想对 Ethane 的扩展，其中策略规定将特定流发送到控制器中的用户进程，从而允许在网络中执行研究人员特定的处理。

**实验2:VLAN。**OpenFlow 可以轻松地为用户提供自己的隔离网络，就像 VLAN 一样。 最简单的方法是静态声明一组流，这些流指定给定 VLAN ID 上的流量可访问的端口。 识别为来自单个用户的流量（例如，源自特定交换机端口或 MAC 地址）由交换机（通过操作）使用适当的 VLAN ID 进行标记。

更动态的方法可能使用控制器来管理用户的身份验证，并使用用户位置的知识在运行时标记流量。

**实验3：移动无线VOIP客户端。**对于这个例子，考虑一个针对支持 WiFi 的电话的新呼叫切换机制的实验。 在实验中，VOIP 客户端通过启用 OpenFlow 的网络建立新连接。 当用户在网络中移动时，控制器被实施以跟踪客户端的位置，通过重新编程流表来重新路由连接，从而实现从一个接入点到另一个接入点的无缝切换。

**实验4：无IP网络。**到目前为止，我们的示例假设一个 IP 网络，但 OpenFlow 不要求数据包是任何一种格式——只要流表能够匹配数据包头。 这将允许使用新的命名、寻址和路由方案进行实验。 启用 OpenFlow 的交换机可以通过多种方式支持非 IP 流量。 例如，可以使用其以太网报头（MAC src 和 dst 地址）、新的 EtherType 值或在 IP 级别通过新的 IP 版本号来识别流。 更一般地说，我们希望未来的交换机将允许控制器创建通用掩码（偏移量 + 值 + 掩码），从而允许以研究人员指定的方式处理数据包。

**实验5：处理包而不是流。**上面的示例适用于涉及流的实验——控制器在流开始时做出决策。 当然，需要进行一些有趣的实验，这些实验需要处理每个数据包。 例如，检查每个数据包的入侵检测系统、显式拥塞控制机制或修改数据包内容时，例如将数据包从一种协议格式转换为另一种协议格式时。

在支持 OpenFlow 的网络中处理数据包有两种基本方法。 首先，也是最简单的，是强制所有流的数据包通过控制器。 为此，控制器不会将新的流条目添加到流交换机中——它只是允许交换机默认将每个数据包转发到控制器。 这具有灵活性的优势，但以性能为代价。 它可能为测试新协议的功能提供了一种有用的方法，但对于在大型网络中的部署不太可能引起人们的兴趣。

处理数据包的第二种方法是将它们路由到进行数据包处理的可编程交换机——例如，基于 NetFPGA 的可编程路由器。 优点是可以以用户定义的方式以线速处理数据包； 图 3 显示了如何做到这一点的示例，其中支持 OpenFlow 的交换机本质上作为一个接线板运行，以允许数据包到达 NetFPGA。 在某些情况下，NetFPGA 板（插入 Linux PC 的 PCI 板）可能会放置在支持 OpenFlow 的交换机旁边的配线柜中，或者（更有可能）放在实验室中。

## 4 OpenFlow联盟

OpenFlow 联盟旨在普及 OpenFlow 并维护 OpenFlow 交换机规范。 该联盟是一群大学和学院的研究人员和网络管理员，他们相信如果在他们的网络中安装支持 OpenFlow 的交换机，他们的研究任务将会得到加强。

会员资格对全球学校、学院、大学或政府机构的任何人开放和免费。 OpenFlow 联盟欢迎未被制造或销售以太网交换机、路由器或无线接入点的公司雇用的个人成员（因为我们希望联盟不受供应商的影响）。 要加入，请发送电子邮件至 join@OpenFlowSwitch.org。

联盟网站 1 包含 OpenFlow 交换机规范、联盟成员列表和 OpenFlow 交换机的参考实现。

**许可模型：**OpenFlow 交换机规范可免费用于所有商业和非商业用途。 （确切的措辞在网站上。）声称“启用 OpenFlow”的商业交换机和路由器必须符合 OpenFlow 0 型交换机的要求，如 OpenFlow 交换机规范中定义的那样。 OpenFlow 是斯坦福大学的商标，将代表联盟受到保护。

## 5. 部署OpenFlow交换机

我们相信网络设备供应商有一个有趣的市场机会，可以向研究界销售支持 OpenFlow 的交换机。数千所高校的每栋建筑都包含带有以太网交换机和路由器的配线间，以及遍布校园的无线接入点。

我们正在积极与多家交换机和路由器制造商合作，这些制造商通过在现有硬件中实施流表来将 OpenFlow 功能添加到他们的产品中；即不需要更改硬件。这些交换机在其现有处理器上运行安全通道软件。

我们发现网络设备供应商对添加 OpenFlow 功能的想法非常开放。大多数供应商都希望支持研究社区，而不必公开其产品的内部工作原理。

我们正在斯坦福大学的计算机科学和电气工程系部署大型 OpenFlow 网络。两座建筑物中的网络将被运行 OpenFlow 的交换机所取代。最终，所有流量都将在 OpenFlow 网络上运行，生产流量和实验流量在网络管理员的控制下隔离在不同的 VLAN 上。研究人员将控制他们自己的流量，并能够添加/删除流条目。

我们还期望研究社区开发出许多不同的 OpenFlow 交换机。 OpenFlow 网站包含多个不同平台的“Type 0”参考设计：Linux（软件）、OpenWRT（软件，用于接入点）和 NetFPGA（硬件，1GE 的 4 端口）。随着社区创建更多参考设计，我们将发布它们。我们鼓励开发人员根据参考设计测试他们的开关。

网站上发布的所有 OpenFlow 交换机的参考实现都将开源并免费用于商业和非商业用途。2

## 6. 结论

我们认为 OpenFlow 是一种务实的折衷方案，它允许研究人员以统一的方式在异构交换机和路由器上运行实验，而无需供应商公开其产品的内部工作原理，也无需研究人员编写供应商特定的控制软件。

如果我们在校园中成功部署 OpenFlow 网络，我们希望 OpenFlow 将逐渐在其他大学中流行起来，增加支持实验的网络数量。 我们希望出现新一代的控制软件，让研究人员能够重复使用控制器和实验，并在他人工作的基础上再接再厉。 随着时间的推移，我们希望不同大学的 OpenFlow 网络孤岛将通过隧道和覆盖网络相互连接，也许还可以通过在连接大学彼此的骨干网络中运行的新 OpenFlow 网络相互连接。